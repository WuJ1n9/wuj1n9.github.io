I"ıT<h1 id="æ±‡ç¼–å®ç°ç”µè¯æœ¬-tips">æ±‡ç¼–å®ç°ç”µè¯æœ¬ Tips</h1>

<p>ä¹‹å‰å®ç°äº†æ±‡ç¼–ç¨‹åºçš„ç”µè¯æœ¬ï¼Œå…¶ä¸­é‡åˆ°å¾ˆå¤šå‘å’Œå¾ˆå¤šæ–°çŸ¥è¯†ï¼Œè¿™é‡Œç¨å¾®æ€»ç»“ä¸€ä¸‹ï¼Œç»™å¤§å®¶æä¾›ä¸€äº›æ€è·¯
ï¼ˆå®Œæ•´ä»£ç è§æœ€åï¼‰</p>

<h2 id="0x01-data-æ®µ">0x01 .data æ®µ</h2>

<p>.data æ®µä¼šå­˜æ”¾å¸¸é‡ã€å…¨å±€å˜é‡ã€è¾“å…¥è¾“å‡ºæç¤ºç¬¦ã€æ‰“å°ä¿¡æ¯ç­‰</p>

<h3 id="æ¢è¡Œ">æ¢è¡Œ</h3>

<p>æ±‡ç¼–ä¸­çš„æ¢è¡Œç¬¦ä¸º <code class="highlighter-rouge">0dh, 0ah</code>ï¼ŒåŒæ—¶éœ€è¦åœ¨å­—ç¬¦ä¸²ç»“å°¾æ·»åŠ  0</p>

<p>ä¾‹ï¼š</p>

<p>```a s
info db â€œHelloâ€, 0dh, 0ah,
	â€œWorld!â€, 0</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>
è¾“å‡ºï¼š

```c
Hello
Worldï¼
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="å®šä¹‰å¸¸é‡">å®šä¹‰å¸¸é‡</h2>

<p><code class="highlighter-rouge">name equ &lt;è¡¨è¾¾å¼&gt;</code></p>

<p>ä¸Šè¿°æ¢è¡Œå°±å¯ä»¥ç®€åŒ–å®šä¹‰æˆä¸€ä¸ªå¸¸é‡</p>

<p><code class="highlighter-rouge">endl EQU &lt;0dh,0ah&gt;</code></p>

<h2 id="å®ç°è¾“å…¥è¾“å‡º">å®ç°è¾“å…¥è¾“å‡º</h2>

<p>æ±‡ç¼–ä¸­å®ç°è¾“å…¥è¾“å‡ºæœ‰å¤šç§æ–¹å¼ï¼Œæ­¤å¤„ä½¿ç”¨ç¬¬ä¸‰ç§ï¼Œå› ä¸ºå®ƒå¯ä»¥æ–¹ä¾¿è¾“å‡ºæ›´å¤šæ•°æ®ç±»å‹ï¼Œä¹Ÿæ›´ç±»ä¼¼ C è¯­æ³•</p>

<p>1ã€ä½¿ç”¨ MASM æä¾›çš„ StdOutã€StdIn å‡½æ•°;</p>

<p>2ã€ä½¿ç”¨ç³»ç»Ÿ API:</p>

<p>3ã€ä½¿ç”¨å¾®è½¯ C æ ‡å‡†åº“ msvcrt.dll ä¸­çš„ crt_printfã€crt_scanf å‡½æ•°.</p>

<p>å‚è€ƒï¼šhttps://www.dbgpro.com/archives/2890.html</p>

<h4 id="è¾“å‡º">è¾“å‡º</h4>

<ol>
  <li>åœ¨ .data æ®µä¸­å®šä¹‰è¦è¾“å‡ºçš„å­—ç¬¦ä¸²</li>
  <li>åœ¨ .code æ®µä¸­è°ƒç”¨å‡½æ•°</li>
</ol>

<p>ä¾‹ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="p">.</span><span class="n">data</span>
	<span class="n">szShowMenu</span> <span class="n">db</span> <span class="s">"ç”µè¯æœ¬ V1.0"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span> 
		<span class="s">"1. æ·»åŠ æ•°æ®"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span>
		<span class="s">"2. æ˜¾ç¤ºæ•°æ®"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span>
		<span class="s">"3. æŸ¥æ‰¾æ•°æ®"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span>
		<span class="s">"4. åˆ é™¤æ•°æ®"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span>
		<span class="s">"5. ä¿®æ”¹æ•°æ®"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span>
		<span class="s">"6. é€€å‡ºç¨‹åº"</span><span class="p">,</span> <span class="n">endl</span><span class="p">,</span>
		<span class="s">"è¯·è¾“å…¥é€‰é¡¹: "</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">.</span><span class="n">code</span>
	<span class="n">push</span> <span class="n">offset</span> <span class="n">szInputNum</span>	<span class="p">;</span> <span class="err">å°†å­—ç¬¦ä¸²åœ°å€å‹å…¥æ ˆä¸­</span>
	<span class="n">call</span> <span class="n">crt_printf</span>			<span class="p">;</span> <span class="err">è°ƒç”¨å‡½æ•°</span>
	<span class="n">add</span> <span class="n">esp</span><span class="p">,</span> <span class="mi">4</span>				<span class="p">;</span> <span class="err">å¹³æ ˆ</span>
	<span class="p">;</span> <span class="err">æˆ–è€…</span>
	<span class="p">;</span> <span class="n">invoke</span> <span class="n">crt_printf</span><span class="p">,</span> <span class="n">addr</span> <span class="n">szInputNum</span>
  <span class="p">;</span> <span class="n">ret</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¾“å‡ºï¼š</p>

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge033uqvx0j30gs0a4q3t.jpg" alt="" /></p>

<h4 id="è¾“å…¥">è¾“å…¥</h4>

<ol>
  <li>åœ¨ .data æ®µå®šä¹‰æ ¼å¼åŒ–å­—ç¬¦ä¸²</li>
  <li>åœ¨ .code æ®µè°ƒç”¨å‡½æ•°</li>
</ol>

<p>ä¾‹ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="p">.</span><span class="n">data</span>
	<span class="n">str_format_int</span>	<span class="n">db</span>	<span class="s">"%c"</span><span class="p">,</span> <span class="mi">0</span>
	<span class="p">;</span> <span class="err">ç”¨äºä¿å­˜èœå•çš„é€‰é¡¹</span>
	<span class="n">choose</span> <span class="n">db</span> <span class="mi">0</span>	<span class="p">;</span> <span class="err">å®šä¹‰å­˜æ”¾è¾“å…¥çš„å˜é‡</span>
<span class="p">.</span><span class="n">code</span>
	<span class="p">;</span> <span class="err">è·å–ç”¨æˆ·çš„è¾“å…¥</span>
	<span class="n">push</span> <span class="n">offset</span> <span class="n">choose</span>	<span class="p">;</span> <span class="err">å­˜æ”¾è¾“å…¥çš„å˜é‡åœ°å€</span>
	<span class="n">push</span> <span class="n">offset</span> <span class="n">str_format_int</span>	<span class="p">;</span> <span class="err">æ ¼å¼åŒ–å­—ç¬¦çš„åœ°å€ï¼Œæ­¤å¤„è¡¨ç¤ºè·å–ä¸€ä¸ªå­—ç¬¦</span>
	<span class="n">call</span> <span class="n">crt_scanf</span>
	<span class="p">;</span> <span class="err">æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œéœ€è¦å¹³è¡¡</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span> <span class="err">å­—èŠ‚</span>
	<span class="n">add</span> <span class="n">esp</span><span class="p">,</span> <span class="mi">8</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="0x02-æ±‡ç¼–ä¸­çš„å‡½æ•°">0x02 æ±‡ç¼–ä¸­çš„å‡½æ•°</h2>

<p>ä»»ä½•é demo éƒ½å»ºè®®ä½¿ç”¨å‡½æ•°æ¥å¢å¼ºä»£ç å¤ç”¨å’Œå¯è¯»æ€§ï¼Œæ±‡ç¼–ä¸­å®šä¹‰å‡½æ•°éœ€è¦ ä½¿ç”¨ <code class="highlighter-rouge">proc</code> å’Œ <code class="highlighter-rouge">endp</code></p>

<pre><code class="language-x86">.code
	Func1 proc
		mov eax, 3
	Func1 endp
	
	main proc
		call Func1
	main endp
	end main
</code></pre>

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge0558ggrfj31dm0u0778.jpg" alt="image-20200420120643558" /></p>

<h2 id="0x03-å¾ªç¯">0x03 å¾ªç¯</h2>

<p>æ±‡ç¼–ä¸­å¾ªç¯å¤šç”¨ <code class="highlighter-rouge">æ ‡å·</code>ã€<code class="highlighter-rouge">jmp</code>ã€<code class="highlighter-rouge">loop</code> å®ç°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¼ªä»£ç ï¼Œä½†é™åˆ¶å¤ªå¤šæ¯”è¾ƒéš¾å®ç°å¤æ‚çš„å¾ªç¯</p>

<p>ä¾‹ï¼š</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">mov</span> <span class="n">eax</span><span class="p">,</span> <span class="n">val1</span>                 			<span class="p">;</span> <span class="err">æŠŠå˜é‡å¤åˆ¶åˆ°</span> <span class="n">EAX</span>
<span class="n">beginwhile</span><span class="o">:</span>
        <span class="n">cmp</span> <span class="n">eax</span><span class="p">,</span> <span class="n">val2</span>                  <span class="p">;</span> <span class="err">å¦‚æœé</span> <span class="n">val1</span> <span class="o">&lt;</span> <span class="n">val2</span>
        <span class="n">jnl</span>     <span class="n">endwhile</span>               <span class="p">;</span> <span class="err">é€€å‡ºå¾ªç¯</span>
        <span class="n">inc</span>    <span class="n">eax</span>                     <span class="p">;</span> <span class="n">val1</span><span class="o">++</span><span class="p">;</span>
        <span class="n">dec</span>    <span class="n">val2</span>                    <span class="p">;</span> <span class="n">val2</span><span class="o">--</span><span class="p">;</span>
        <span class="n">jmp</span>    <span class="n">beginwhile</span>              <span class="p">;</span> <span class="err">é‡å¤å¾ªç¯</span>
<span class="n">endwhile</span><span class="o">:</span>
        <span class="n">mov</span>    <span class="n">val1</span><span class="p">,</span> <span class="n">eax</span>                <span class="p">;</span><span class="err">ä¿å­˜</span> <span class="n">val1</span> <span class="err">çš„æ–°å€¼</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>å‚è€ƒï¼šhttp://c.biancheng.net/view/3579.html</p>

<h2 id="0x04-å®ç°æ•°ç»„éå†æŸ¥è¯¢åŠŸèƒ½">0x04 å®ç°æ•°ç»„éå†ï¼ˆæŸ¥è¯¢åŠŸèƒ½ï¼‰</h2>

<p>å®ç°æ•°ç»„éå†ï¼Œå³æ‰¾åˆ°å¯¹åº”æ•°ç»„ä¿¡æ¯æ˜¯éå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œé™¤äº†æŸ¥è¯¢ï¼Œåˆ é™¤å’Œä¿®æ”¹éƒ½è¦ç”¨åˆ°è¿™ä¸ªåŠŸèƒ½</p>

<h3 id="repe-cmpsb-æŒ‡ä»¤è§£æ">repe cmpsb æŒ‡ä»¤è§£æ</h3>

<p>repe æ˜¯ä¸€ä¸ªä¸²æ“ä½œå‰ç¼€ï¼Œå®ƒé‡å¤ä¸²æ“ä½œæŒ‡ä»¤ï¼Œæ¯é‡å¤ä¸€æ¬¡ ECX çš„å€¼å°±å‡ä¸€
ä¸€ç›´åˆ° CX ä¸º 0 æˆ– ZF ä¸º 0 æ—¶åœæ­¢ã€‚</p>

<p>cmpsb æ˜¯å­—ç¬¦ä¸²æ¯”è¾ƒæŒ‡ä»¤ï¼ŒæŠŠ ESI æŒ‡å‘çš„æ•°æ®ä¸ EDI æŒ‡å‘çš„æ•°ä¸€ä¸ªä¸€ä¸ªçš„è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœä¸¤ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œå³ ZF ä¸º 1ï¼Œå½“ä¸ç›¸ç­‰æ—¶ ZF ä¸º 0</p>

<p>å½“ repe cmpsb é…åˆä½¿ç”¨æ—¶å°±æ˜¯å®ç°å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œå½“ç›¸åŒæ—¶ç»§ç»­æ¯”è¾ƒï¼Œä¸åŒæ—¶ï¼ˆZF = 0ï¼‰åœæ­¢æ¯”è¾ƒ</p>

<pre><code class="language-asm">start_for:
	cmp edx, count
	jnb info_output

	; è·å–ç»“æ„ä½“çš„å¤§å°
	mov eax, sizeof(Contact)
	; edx ç›¸å½“äºè®¡æ•°å™¨ iï¼Œè®¡ç®— arr[i] çš„åç§»
	imul eax, edx
	; è·å–æ•°ç»„é¦–åœ°å€
	lea esi, TeleContacts
	; è®¡ç®—å¯¹åº”ä¸‹æ ‡ i å…ƒç´ çš„é¦–åœ°å€
	add esi, eax

	; username é‡Œå­˜æ”¾æˆ‘ä»¬è¾“å…¥çš„æƒ³è¦æŸ¥è¯¢çš„å­—ç¬¦ä¸²
	lea edi,  username
	; è¿™é‡Œæ˜¯è¦è¿›è¡Œå¯¹æ¯”çš„ç¬¬ i ä¸ªæ•°ç»„çš„å­—ç¬¦ä¸²
	lea esi, [esi + Contact.user]
	; è®¾å®šæœ€é•¿å¯¹æ¯”é•¿åº¦
	mov ecx, 20h

	; æ¯”è¾ƒ edi å’Œ esi é‡Œå­˜çš„å­—ç¬¦ä¸²
	repe cmpsb
	; ä¸ç›¸ç­‰å°±è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ï¼ˆæ­¤æ—¶ ZF=0 jnzä¼šè·³è½¬ï¼‰
	jne next_for
	; ç›¸ç­‰å°±æ‰“å°ä¿¡æ¯
	xxx ; ç•¥
next_for:
	inc edx
	jmp start_for
</code></pre>

<h2 id="0x05-åˆ é™¤åŠŸèƒ½">0x05 åˆ é™¤åŠŸèƒ½</h2>

<p>é¦–å…ˆæ‰¾åˆ°æˆ‘ä»¬éœ€è¦åˆ é™¤çš„ä¿¡æ¯ï¼ŒåŒä¸Š</p>

<p>ä¹‹åï¼Œä»åä¸€ä¸ªæ•°ç»„å…ƒç´ å¼€å§‹çš„åœ°å€ï¼Œå°†æ¯ä¸ªå­—èŠ‚éƒ½å‘å‰å¡«å……åˆ°å‰ä¸€ä¸ªå…ƒç´ çš„åœ°å€ï¼Œå€Ÿæ­¤å®ç°è¯¥æ•°ç»„å…ƒç´ çš„åˆ é™¤</p>

<h3 id="rep-movsb-æŒ‡ä»¤è§£æ">rep movsb æŒ‡ä»¤è§£æ</h3>

<p>æ¬ç§»å­—ä¸²æŒ‡ä»¤æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ MOVSB å’Œ MOVSWï¼Œå…ˆè¯´ MOVSBã€‚MOVSB çš„è‹±æ–‡æ˜¯ move string byteï¼Œæ„æ€æ˜¯æ¬ç§»ä¸€ä¸ªå­—èŠ‚ï¼Œå®ƒæ˜¯æŠŠ DS:SI æ‰€æŒ‡åœ°å€çš„ä¸€ä¸ªå­—èŠ‚æ¬ç§»åˆ° ES:DI æ‰€æŒ‡çš„åœ°å€ä¸Šï¼Œæ¬ç§»ååŸæ¥çš„å†…å®¹ä¸å˜ï¼Œä½†æ˜¯åŸæ¥ ES:DI æ‰€æŒ‡çš„å†…å®¹ä¼šè¢«è¦†ç›–è€Œä¸”åœ¨æ¬ç§»ä¹‹å SI å’Œ DI ä¼šè‡ªåŠ¨åœ°å€å‘ä¸‹ä¸€ä¸ªè¦æ¬ç§»çš„åœ°å€ã€‚</p>

<p>é€šå¸¸ï¼Œç¨‹åºå¹¶ä¸ä¼šåªæ¬ä¸€ä¸ªå­—èŠ‚ï¼Œéƒ½ä¼šé‡å¤è®¸å¤šæ¬¡ï¼Œå¦‚æœè¦é‡å¤çš„è¯ï¼Œå°±å¾—æŠŠé‡å¤æ¬¡æ•° ( ä¹Ÿå°±æ˜¯å­—ä¸²é•¿åº¦ ) å…ˆè®°å½•åœ¨ CX å¯„å­˜å™¨ï¼Œå¹¶ä¸”åœ¨ MOVSB ä¹‹å‰åŠ ä¸Š REP æŒ‡ä»¤ï¼ŒREP æ˜¯é‡å¤ (repeat) çš„æ„æ€ã€‚</p>

<p>ä¸€èˆ¬è€Œè¨€æ±‡ç¼–è¯­è¨€æºæ–‡ä»¶çš„æ¯ä¸€è¡Œéƒ½åªæœ‰ä¸€ä¸ªæŒ‡ä»¤ï¼Œä½† REP MOVSB å´å¯ä»¥åœ¨åŒä¸€è¡Œå†™ä¸¤ä¸ªæŒ‡ä»¤ï¼Œå½“ç„¶åˆ†å¼€å†™ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</p>

<pre><code class="language-asm">del_process:
	; å°†åºå·åçš„å­—èŠ‚éƒ½å‰ç§»
	mov ebx, find_i
	mov ecx, sizeof(Contact)
	imul ebx, ecx
	lea edi, TeleContacts
	; è·å–ç›®çš„åœ°å€
	add edi, ebx
	; è·å–æºåœ°å€ï¼ˆç›®çš„åœ°å€åä¸€ä¸ªï¼‰
	mov esi, edi
	add esi, ecx

	; è®¡ç®—æ‹·è´æ•°é‡
	mov eax, count
	sub eax, find_i
	; éœ€è¦å‰ç§»çš„å­—èŠ‚
	imul ecx, eax

	; å¾ªç¯å‰ç§» æŠŠ DS:SI æ‰€æŒ‡åœ°å€çš„ä¸€ä¸ªå­—èŠ‚æ¬ç§»åˆ° ES:DI æ‰€æŒ‡çš„åœ°å€ä¸Š
	rep movsb
	; æ€»æ•° -1
	dec count
	; æˆåŠŸåˆ é™¤
	push offset szDelSuccess
	call crt_printf
	add esp, 4
</code></pre>

<h2 id="0x06-å®Œæ•´ä»£ç ">0x06 å®Œæ•´ä»£ç </h2>

<pre><code class="language-asm">; .386
; .model flat,stdcall
; .stack 4096

include Irvine32.inc
includelib kernel32.lib
includelib Irvine32.lib
include msvcrt.inc
includelib msvcrt.lib
include masm32.inc
includelib masm32.lib



ExitProcess proto,dwExitCode:dword

; å®šä¹‰éœ€è¦çš„ç»“æ„ä½“
Contact struct
    ; éœ€è¦å®šä¹‰çš„æ•°æ®
    user db 32 dup(0)
    tel db 20 dup(0)
Contact ends

.data

; è®¾ç½®æ§åˆ¶å°æ ‡é¢˜
titleStr BYTE "æ±‡ç¼–ç”µè¯æœ¬ V1.0    Author: WuJ1n9", 0

endl EQU &lt;0dh,0ah&gt;            ; è¡Œç»“å°¾

; å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ•°ç»„ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰çš„è”ç³»äºº
TeleContacts Contact 100 dup(&lt;'0'&gt;)
TempTeleContacts Contact &lt;'0', '0'&gt;

; ç”¨äºä¿å­˜èœå•çš„é€‰é¡¹
choose db 0

; æ¸…ç©ºå±å¹•
str_system_cls db "cls", 0

; å½“å‰æœ€å¤šèƒ½å­˜æ”¾å¤šå°‘ä¸ªæ•°æ®
max_count dd 20

; æš‚åœ
str_system_pause db "pause", 0dh, 0ah, 0

; å·²ç»å­˜æ”¾äº†å¤šå°‘ä¸ªæ•°æ®
count dd 0

; åºå·
find_i dd 0

; ç”¨äºä¿å­˜ç”¨æˆ·åå’Œç”µè¯
username db 32 dup(0)
telenum db 20 dup(0)

szShowMenu db "ç”µè¯æœ¬ V1.0", endl, 
		 "1. æ·»åŠ æ•°æ®", endl,
         "2. æ˜¾ç¤ºæ•°æ®", endl,
         "3. æŸ¥æ‰¾æ•°æ®", endl,
		 "4. åˆ é™¤æ•°æ®", endl,
		 "5. ä¿®æ”¹æ•°æ®", endl,
         "6. é€€å‡ºç¨‹åº", endl,
         "è¯·è¾“å…¥é€‰é¡¹: ", 0
         ; 0dh 0ah == \r\n 0 å­—ç¬¦ä¸²ç»“å°¾
ShowMenuSize db	($ - szShowMenu)

szInputName db "è¯·è¾“å…¥è”ç³»äººçš„å§“åï¼š", endl, 0
InputNameSize db ($ - szInputName)
szInputNum db "è¯·è¾“å…¥è”ç³»äººçš„ç”µè¯ï¼š", endl, 0
szInputError db "è¯·é‡æ–°è¾“å…¥æ ¼å¼æ­£ç¡®çš„é€‰é¡¹!ï¼ˆæ•°å­—1-6ï¼‰", endl, 0
szFenGe db "&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;", endl, 0
szFind db "è¯·è¾“å…¥è¦æŸ¥è¯¢è”ç³»äººçš„å§“åï¼š", endl, 0
szFindNoone db "æŸ¥æ— æ­¤äºº", endl, 0
szDelWho db "è¯·è¾“å…¥è¦åˆ é™¤è”ç³»äººçš„å§“åï¼š", endl, 0
szDelSuccess db "åˆ é™¤æˆåŠŸï¼", endl, 0
szModify db "è¯·è¾“å…¥è¦ä¿®æ”¹è”ç³»äººçš„å§“åï¼š", endl, 0
szModifySuccess db "ä¿®æ”¹æˆåŠŸï¼", endl, 0
szInputNewName db "è¯·è¾“å…¥æ–°çš„è”ç³»äººå§“åï¼š", endl, 0
szInputNewNum db "è¯·è¾“å…¥æ–°çš„è”ç³»äººç”µè¯ï¼š", endl, 0

str_printf_size db "è¶…å‡ºå®¹é‡", 0dh, 0ah, 0
str_format_str	db		"%s", 0
str_format_int	db		" %c", 0 ; æ­¤å¤„å‰é¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œç”¨äºæŠŠæ¢è¡Œç¬¦åƒæ‰
; è¾“å‡ºè”ç³»äººä¿¡æ¯
str_show_content db "%d: %-7s %-7s", 0dh, 0ah, 0

stdOutHandle	HANDLE	0     ; æ ‡å‡†è¾“å‡ºè®¾å¤‡å¥æŸ„
stdInHandle		HANDLE	0

byteWritten	DWORD ?      ; è¾“å‡ºå­—èŠ‚æ•°
bytesRead   DWORD ?

.code

; æ§åˆ¶å°æ ‡é¢˜
INVOKE SetConsoleTitle, ADDR titleStr


AddData proc
		; è·å–å½“å‰å·²å­˜æ”¾çš„ä¸ªæ•°
		mov ecx, count
		; åˆ¤æ–­æ˜¯å¦å¤§äºå®¹é‡
		
		.if ecx == max_count
		; å¦‚æœè¶…å‡ºäº†ï¼Œå°±æŠ¥é”™
		jmp size_error
		.endif

		; æ‰“å°æç¤º
		; å› ä¸º printf ä¼šä¿®æ”¹ edx, ecx å’Œ eax çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¿å­˜
		push edx
		push eax
		push ecx
		push offset szInputName
		call crt_printf
		add esp, 4
		pop ecx
		pop eax
		pop edx

		; æ¥æ”¶ç”¨æˆ·çš„è¾“å…¥
		; è·å–ç»“æ„ä½“çš„å¤§å°
		mov eax, sizeof(Contact)
		; è®¡ç®—åç§»
		imul eax, ecx
		; è·å–æ•°ç»„é¦–åœ°å€
		lea esi, TeleContacts
		; è®¡ç®—å¯¹åº”ä¸‹æ ‡å…ƒç´ çš„é¦–åœ°å€
		add esi, eax

		; è·å–è”ç³»äºº
		lea ebx, [esi + Contact.user]
		push ebx
		push offset str_format_str
		call crt_scanf
		add esp, 8

		; æ‰“å°æç¤º
		; å› ä¸º printf ä¼šä¿®æ”¹ edx, ecx å’Œ eax çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦è¿›è¡Œä¿å­˜
		push edx
		push eax
		push ecx
		push offset szInputNum
		call crt_printf
		add esp, 4
		pop ecx
		pop eax
		pop edx

		; è·å–è”ç³»äººç”µè¯
		lea ebx, [esi + Contact.tel]
		push ebx
		push offset str_format_str
		call crt_scanf
		; å¹³æ ˆ
		add esp, 8

		; è‡ªå¢è®¡æ•°å™¨ count
		inc count
		jmp ret_addr

size_error:
		push offset str_printf_size
		call crt_printf
		add esp, 4

ret_addr:
		ret
AddData endp


ShowData proc
	; æ‰“å°åˆ†å‰²ç¬¦
	push offset szFenGe
	call crt_printf
	add esp, 4

	mov ecx, 0
	.while ecx &lt; count
		; è·å–ç»“æ„ä½“çš„å¤§å°
		mov eax, sizeof(Contact)
		; è®¡ç®—åç§»
		imul eax, ecx
		; è·å–æ•°ç»„é¦–åœ°å€
		lea esi, TeleContacts
		; è®¡ç®—å¯¹åº”ä¸‹æ ‡å…ƒç´ çš„é¦–åœ°å€
		add esi, eax

		; æ‰“å°æ‰€æœ‰è”ç³»äººä¿¡æ¯
		push ecx    ; ä¿å­˜åŸå§‹ ecx
		lea ebx, [esi + Contact.tel]
		push ebx
		lea ebx, [esi + Contact.user]
		push ebx
		push ecx
		push offset str_show_content
		call crt_printf
		add esp, 10h
		pop ecx     ; æ¢å¤ ecx

		; è‡ªå¢ä¸‹æ ‡
		inc ecx
	.endw

	; æ‰“å°åˆ†å‰²ç¬¦
	push offset szFenGe
	call crt_printf
	add esp, 4

ret
ShowData endp


FindData proc
	; æç¤ºè¾“å…¥æŸ¥æ‰¾çš„å§“å
    push offset szFind
	call crt_printf
	add esp, 4

	; è·å–è¾“å…¥çš„ç”¨æˆ·å scanf("%s", username)
	push offset username
	push offset str_format_str
	call crt_scanf
	add esp, 8

	mov byte ptr [username + 31],0

	mov edx, 0
start_for:
	cmp edx, count
	jnb info_output

	;åŒä¸Š
	mov eax, sizeof(Contact)
	imul eax, edx
	lea esi, TeleContacts
	add esi, eax

	lea edi,  username
	lea esi, [esi + Contact.user]
	mov ecx, 20h

	; æ¯”è¾ƒ edi å’Œ esi é‡Œå­˜çš„å­—ç¬¦ä¸²
	repe cmpsb
	; ä¸ç›¸ç­‰å°±è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
	jne next_for
	; ç›¸ç­‰å°±æ‰“å°ä¿¡æ¯
	push edx    ; ä¿å­˜ edx
	; æ¢å¤ esi
	lea esi, TeleContacts
	add esi, eax
	; è¾“å‡º
	lea ebx, [esi + Contact.tel]
	push ebx
	lea ebx, [esi + Contact.user]
	push ebx
	push edx
	push offset str_show_content
	call crt_printf
	add esp, 10h
	pop edx    ; æ¢å¤ edx
	jmp end_for		; ç»“æŸå¾ªç¯

next_for:
	inc edx
	jmp start_for

info_output:
	push offset szFindNoone
	call crt_printf
	add esp, 4

end_for:
	ret

FindData endp


DelData proc
	; æ‰“å°æç¤ºä¿¡æ¯
	push offset szDelWho
	call crt_printf
	add esp, 4

	; è·å–è¾“å…¥çš„ç”¨æˆ·å scanf("%s", username)
	push offset username
	push offset str_format_str
	call crt_scanf
	add esp, 8

	; æŸ¥è¯¢è¯¥ç”¨æˆ·çš„åºå·
	mov edx, 0
start_for:
	cmp edx, count
	jnb info_output

	;åŒä¸Š
	mov eax, sizeof(Contact)
	imul eax, edx
	lea esi, TeleContacts
	add esi, eax

	lea edi,  username
	lea esi, [esi + Contact.user]
	mov ecx, 20h

	; æ¯”è¾ƒ edi å’Œ esi é‡Œå­˜çš„å­—ç¬¦ä¸²
	repe cmpsb
	; ä¸ç›¸ç­‰å°±è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
	jne next_for
	; ç›¸ç­‰ï¼Œedx å°±æ˜¯è¯¥ç”¨æˆ·çš„åºå·
	mov find_i, edx
	jmp del_process		; ç»“æŸå¾ªç¯

next_for:
	inc edx
	jmp start_for

info_output:
	push offset szFindNoone
	call crt_printf
	add esp, 4
	jmp exit_prog

del_process:
	; å°†åºå·åçš„å­—èŠ‚éƒ½å‰ç§»
	mov ebx, find_i
	mov ecx, sizeof(Contact)
	imul ebx, ecx
	lea edi, TeleContacts
	; è·å–ç›®çš„åœ°å€
	add edi, ebx
	; è·å–æºåœ°å€ï¼ˆç›®çš„åœ°å€åä¸€ä¸ªï¼‰
	mov esi, edi
	add esi, ecx

	; è®¡ç®—æ‹·è´æ•°é‡
	mov eax, count
	sub eax, find_i
	; éœ€è¦å‰ç§»çš„å­—èŠ‚
	imul ecx, eax

	; å¾ªç¯å‰ç§» æŠŠ DS:SI æ‰€æŒ‡åœ°å€çš„ä¸€ä¸ªå­—èŠ‚æ¬ç§»åˆ° ES:DI æ‰€æŒ‡çš„åœ°å€ä¸Š
	rep movsb
	; æ€»æ•° -1
	dec count
	; æˆåŠŸåˆ é™¤
	push offset szDelSuccess
	call crt_printf
	add esp, 4

exit_prog:
	ret
DelData endp


ModifyData proc
	; æ‰“å°æç¤ºä¿¡æ¯
	push offset szModify
	call crt_printf
	add esp, 4

	; è·å–è¾“å…¥çš„ç”¨æˆ·å scanf("%s", username)
	push offset username
	push offset str_format_str
	call crt_scanf
	add esp, 8

	; æŸ¥è¯¢è¯¥ç”¨æˆ·çš„åºå·
	mov edx, 0
start_for:
	cmp edx, count
	jnb info_output

	;åŒä¸Š
	mov eax, sizeof(Contact)
	imul eax, edx
	lea esi, TeleContacts
	add esi, eax

	lea edi,  username
	lea esi, [esi + Contact.user]
	mov ecx, 20h

	; æ¯”è¾ƒ edi å’Œ esi é‡Œå­˜çš„å­—ç¬¦ä¸²
	repe cmpsb
	; ä¸ç›¸ç­‰å°±è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯
	jne next_for
	; ç›¸ç­‰ï¼Œedx å°±æ˜¯è¯¥ç”¨æˆ·çš„åºå·
	mov find_i, edx
	jmp modify_process		; ç»“æŸå¾ªç¯

next_for:
	inc edx
	jmp start_for

info_output:
	push offset szFindNoone
	call crt_printf
	add esp, 4
	jmp exit_prog

modify_process:
	; è¾“å…¥æ–°çš„å§“å
	push offset szInputNewName
	call crt_printf
	add esp, 4
	; è·å–è¾“å…¥çš„ç”¨æˆ·å scanf("%s", username)
	push offset TempTeleContacts.user
	push offset str_format_str
	call crt_scanf
	add esp, 8
	; è¾“å…¥æ–°çš„ç”µè¯
	push offset szInputNewNum
	call crt_printf
	add esp, 4
	; è·å–ç”µè¯å·ç 
	push offset TempTeleContacts.tel
	push offset str_format_str
	call crt_scanf
	add esp, 8

	; ä¿®æ”¹
	mov ecx, sizeof(Contact)
	mov eax, find_i
	lea esi, TempTeleContacts
	lea edi, TeleContacts
	imul eax, ecx
	add edi, eax
	; æŠŠ DS:SI æ‰€æŒ‡åœ°å€çš„ä¸€ä¸ªå­—èŠ‚æ¬ç§»åˆ° ES:DI æ‰€æŒ‡çš„åœ°å€ä¸Š
	rep movsb
	; æˆåŠŸä¿®æ”¹
	push offset szModifySuccess
	call crt_printf
	add esp, 4

exit_prog:
	ret
ModifyData endp


main proc

begin_while:

	; æ¸…ç©ºå±å¹•
	push offset str_system_cls
	call crt_system
	add esp, 4	

	; è·å¾—æ§åˆ¶å°è¾“å‡ºå¥æŸ„
	invoke	GetStdHandle, STD_OUTPUT_HANDLE
	mov		stdOutHandle, eax
	; æ‰“å°ç”µè¯æœ¬é¦–é¡µ
	invoke	WriteConsole, stdOutHandle,          ; æ§åˆ¶å°è¾“å‡ºå¥æŸ„
						  addr szShowMenu,           ; å­—ç¬¦ä¸²æŒ‡é’ˆ
					      ShowMenuSize,            ; å­—ç¬¦é•¿åº¦
						  addr byteWritten,      ; è¿”å›è¾“å‡ºå­—èŠ‚æ•°
						  0                       ; æœªä½¿ç”¨
	
	; è·å¾—æ§åˆ¶å°è¾“å…¥å¥æŸ„
	; invoke	GetStdHandle, STD_INPUT_HANDLE
    ; mov		stdInHandle,  eax
	; ç­‰å¾…ç”¨æˆ·è¾“å…¥
    ; invoke	ReadConsole,  stdInHandle, 
	;					  ADDR choose,
	;					  1, 
	;					  ADDR bytesRead, 0
	;invoke	StdOut,       addr choose
    ;ret 
	
	; è·å–ç”¨æˆ·çš„è¾“å…¥
	push offset choose
	push offset str_format_int
	call crt_scanf
    ; æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œéœ€è¦å¹³è¡¡ 2*4 å­—èŠ‚
	add esp, 8

	.if choose == "1"	
		call AddData
		jmp end_switch
	.elseif choose =="2"
		call ShowData
		jmp end_switch
	.elseif choose == "3"
		call FindData
		jmp end_switch
	.elseif choose == "4"
		call DelData
		jmp end_switch
	.elseif choose == "5"
		call ModifyData
		jmp end_switch
	.elseif choose == "6"
		jmp exit_prog 
	.else
		jmp input_error
	.endif

; æç¤ºè¾“å…¥æ­£ç¡®é€‰é¡¹
input_error:
	push offset szInputError
	call crt_printf
	add esp, 4

; æ·»åŠ æš‚åœ
end_switch:
	push offset str_system_pause
	call crt_system
	add esp, 4

	jmp begin_while

; é€€å‡º
exit_prog:
	INVOKE ExitProcess,0

main endp
end main
</code></pre>

:ET